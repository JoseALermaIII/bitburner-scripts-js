<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: shutdown.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: shutdown.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import * as getServers from "getServers.js";
import * as bestServers from "listBestServers.js";
/** @param {NS} ns **/
// Shutdown script on all local and remote servers.

// Logging
const logFile = "/logs/shutdown.txt";
const logMode = "w";

// Functions
export function ifRunningKillScript(ns, script, serv) {
	/* If script named `script` exists on server named `serv`
	 * kill all processes regardless of arguments
	 */
	if (ns.scriptRunning(script, serv)) {
		ns.scriptKill(script, serv);
	}
}

export async function main(ns) {
	await ns.write(logFile, "Start shutdown.js\n", logMode);

	// Constants and variables
	let script = "earlyHackTemplate.js"; // Script to stop
	const servers = await getServers.main(ns); // Map of servers
	const hackable = Array.from(Array(6), () => new Array()); // Hackable servers
	let purchasedServers = ns.getPurchasedServers(); // Purchased servers
	await ns.write(logFile, `Purchased servers: ${purchasedServers}\n`, "a");

	// Determine servers where the script can be running
	bestServers.getHackable(ns, servers, hackable);
	await ns.write(logFile, `Hackable servers: ${hackable.join(",\n")}\n`, "a");

	for (let serv of purchasedServers) {
		ifRunningKillScript(ns, script, serv); // Check if script is running on our local servers.
	}
	await ns.write(logFile, "Finished shutting down local servers.\n", "a");

	for (let serverList of hackable) {
		// Check if script is running on currently running servers.
		if (serverList.length === 0) {
			continue; // Skip if there are no servers
		}

		for (let serv of serverList) {
			ifRunningKillScript(ns, script, serv);
		}
	}

	await ns.write(logFile, "Finished shutting down running servers.\n", "a");
	await ns.write(logFile, "End shutdown.js\n", "a");
	ns.tprint("shutdown.js Done.");
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#copyAndRun">copyAndRun</a></li><li><a href="global.html#logFile">logFile</a></li><li><a href="global.html#logMode">logMode</a></li><li><a href="global.html#main">main</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Sun Mar 20 2022 20:29:38 GMT-0500 (Central Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
